"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.synth = void 0;
const os = require("os");
const path = require("path");
const fs = require("fs-extra");
const common_1 = require("../common");
const logging = require("../logging");
const projenfile = path.resolve(common_1.PROJEN_RC);
const projen = path.join(__dirname, '..');
async function synth() {
    if (!fs.existsSync(projenfile)) {
        logging.error(`Unable to find ${projenfile}. Use "projen new" to create a new project.`);
        process.exit(1);
    }
    // if node_modules/projen is not a directory or does not exist, create a
    // temporary symlink to the projen that we are currently running in order to
    // allow .projenrc.js to `require()` it.
    logging.info('Synthesizing project...');
    const projenModulePath = path.resolve('node_modules', 'projen');
    if (!fs.existsSync(path.join(projenModulePath, 'package.json')) || !fs.statSync(projenModulePath).isDirectory()) {
        fs.removeSync(projenModulePath);
        fs.mkdirpSync('node_modules');
        fs.symlinkSync(projen, projenModulePath, (os.platform() === 'win32') ? 'junction' : null);
    }
    // eslint-disable-next-line @typescript-eslint/no-require-imports
    require(projenfile);
}
exports.synth = synth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ludGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY2xpL3N5bnRoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLHNDQUFzQztBQUN0QyxzQ0FBc0M7QUFFdEMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBUyxDQUFDLENBQUM7QUFDM0MsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFFbkMsS0FBSyxVQUFVLEtBQUs7SUFDekIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDOUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsVUFBVSw2Q0FBNkMsQ0FBQyxDQUFDO1FBQ3pGLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDakI7SUFFRCx3RUFBd0U7SUFDeEUsNEVBQTRFO0lBQzVFLHdDQUF3QztJQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDeEMsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNoRSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7UUFDL0csRUFBRSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hDLEVBQUUsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDOUIsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDM0Y7SUFFRCxpRUFBaUU7SUFDakUsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3RCLENBQUM7QUFuQkQsc0JBbUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IFBST0pFTl9SQyB9IGZyb20gJy4uL2NvbW1vbic7XG5pbXBvcnQgKiBhcyBsb2dnaW5nIGZyb20gJy4uL2xvZ2dpbmcnO1xuXG5jb25zdCBwcm9qZW5maWxlID0gcGF0aC5yZXNvbHZlKFBST0pFTl9SQyk7XG5jb25zdCBwcm9qZW4gPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN5bnRoKCkge1xuICBpZiAoIWZzLmV4aXN0c1N5bmMocHJvamVuZmlsZSkpIHtcbiAgICBsb2dnaW5nLmVycm9yKGBVbmFibGUgdG8gZmluZCAke3Byb2plbmZpbGV9LiBVc2UgXCJwcm9qZW4gbmV3XCIgdG8gY3JlYXRlIGEgbmV3IHByb2plY3QuYCk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG5cbiAgLy8gaWYgbm9kZV9tb2R1bGVzL3Byb2plbiBpcyBub3QgYSBkaXJlY3Rvcnkgb3IgZG9lcyBub3QgZXhpc3QsIGNyZWF0ZSBhXG4gIC8vIHRlbXBvcmFyeSBzeW1saW5rIHRvIHRoZSBwcm9qZW4gdGhhdCB3ZSBhcmUgY3VycmVudGx5IHJ1bm5pbmcgaW4gb3JkZXIgdG9cbiAgLy8gYWxsb3cgLnByb2plbnJjLmpzIHRvIGByZXF1aXJlKClgIGl0LlxuICBsb2dnaW5nLmluZm8oJ1N5bnRoZXNpemluZyBwcm9qZWN0Li4uJyk7XG4gIGNvbnN0IHByb2plbk1vZHVsZVBhdGggPSBwYXRoLnJlc29sdmUoJ25vZGVfbW9kdWxlcycsICdwcm9qZW4nKTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihwcm9qZW5Nb2R1bGVQYXRoLCAncGFja2FnZS5qc29uJykpIHx8ICFmcy5zdGF0U3luYyhwcm9qZW5Nb2R1bGVQYXRoKS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgZnMucmVtb3ZlU3luYyhwcm9qZW5Nb2R1bGVQYXRoKTtcbiAgICBmcy5ta2RpcnBTeW5jKCdub2RlX21vZHVsZXMnKTtcbiAgICBmcy5zeW1saW5rU3luYyhwcm9qZW4sIHByb2plbk1vZHVsZVBhdGgsIChvcy5wbGF0Zm9ybSgpID09PSAnd2luMzInKSA/ICdqdW5jdGlvbicgOiBudWxsKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gIHJlcXVpcmUocHJvamVuZmlsZSk7XG59XG4iXX0=