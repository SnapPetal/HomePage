"use strict";var e=require("./defaultRoleAssumers-f1274937.js"),t=require("./httpRequest-eeeab15a.js"),a=require("./_commonjsHelpers-429052b6.js"),r=require("stream"),n=require("fs"),s=require("./configurations-a8a5ec49.js");require("http2");var o=require("./index-b1a90fae.js"),i=require("./serdePlugin-96c19d04.js");require("url"),require("buffer"),require("http"),require("os"),require("path"),require("child_process"),require("crypto"),require("https"),require("process");var c="3.19.0",u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};var l=function(){return(l=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function f(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],r=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var r,n,s=a.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return o}function p(e){return this instanceof p?(this.v=e,this):new p(e)}var w=Object.freeze({__proto__:null,__extends:function(e,t){function a(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},get __assign(){return l},__rest:function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a},__decorate:function(e,t,a,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},__param:function(e,t){return function(a,r){t(a,r,e)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(e,t,a,r){return new(a||(a=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function i(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))},__generator:function(e,t){var a,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{a=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},__createBinding:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]},__exportStar:function(e,t){for(var a in e)"default"===a||t.hasOwnProperty(a)||(t[a]=e[a])},__values:f,__read:h,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<a;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,n++)r[n]=s[o];return r},__await:p,__asyncGenerator:function(e,t,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=a.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){n[e]&&(r[e]=function(t){return new Promise((function(a,r){s.push([e,t,a,r])>1||i(e,t)}))})}function i(e,t){try{(a=n[e](t)).value instanceof p?Promise.resolve(a.value.v).then(c,u):l(s[0][2],a)}catch(e){l(s[0][3],e)}var a}function c(e){i("next",e)}function u(e){i("throw",e)}function l(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}},__asyncDelegator:function(e){var t,a;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,n){t[r]=e[r]?function(t){return(a=!a)?{value:p(e[r](t)),done:"return"===r}:n?n(t):t}:n}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,a=e[Symbol.asyncIterator];return a?a.call(e):(e=f(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(a){t[a]=e[a]&&function(t){return new Promise((function(r,n){(function(e,t,a,r){Promise.resolve(r).then((function(t){e({value:t,done:a})}),t)})(r,n,(t=e[a](t)).done,t.value)}))}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,a){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,a),a}}),m=a.getAugmentedNamespace(w),d=a.createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Crc32=t.crc32=void 0,t.crc32=function(e){return(new a).update(e).digest()};var a=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,a;try{for(var n=m.__values(e),s=n.next();!s.done;s=n.next()){var o=s.value;this.checksum=this.checksum>>>8^r[255&(this.checksum^o)]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=n.return)&&a.call(n)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}();t.Crc32=a;var r=Uint32Array.from([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117])})),v=function(){function t(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}return t.fromNumber=function(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(e+" is too large (or, if negative, too small) to represent as an Int64");for(var a=new Uint8Array(8),r=7,n=Math.abs(Math.round(e));r>-1&&n>0;r--,n/=256)a[r]=n;return e<0&&y(a),new t(a)},t.prototype.valueOf=function(){var t=this.bytes.slice(0),a=128&t[0];return a&&y(t),parseInt(e.toHex(t),16)*(a?-1:1)},t.prototype.toString=function(){return String(this.valueOf())},t}();function y(e){for(var t=0;t<8;t++)e[t]^=255;for(t=7;t>-1&&(e[t]++,0===e[t]);t--);}var b,g=function(){function a(e,t){this.toUtf8=e,this.fromUtf8=t}return a.prototype.format=function(e){var a,r,n,s,o=[];try{for(var i=t.__values(Object.keys(e)),c=i.next();!c.done;c=i.next()){var u=c.value,l=this.fromUtf8(u);o.push(Uint8Array.from([l.byteLength]),l,this.formatHeaderValue(e[u]))}}catch(e){a={error:e}}finally{try{c&&!c.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}var f=new Uint8Array(o.reduce((function(e,t){return e+t.byteLength}),0)),h=0;try{for(var p=t.__values(o),w=p.next();!w.done;w=p.next()){var m=w.value;f.set(m,h),h+=m.byteLength}}catch(e){n={error:e}}finally{try{w&&!w.done&&(s=p.return)&&s.call(p)}finally{if(n)throw n.error}}return f},a.prototype.formatHeaderValue=function(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":var a=new DataView(new ArrayBuffer(3));return a.setUint8(0,3),a.setInt16(1,t.value,!1),new Uint8Array(a.buffer);case"integer":var r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,t.value,!1),new Uint8Array(r.buffer);case"long":var n=new Uint8Array(9);return n[0]=5,n.set(t.value.bytes,1),n;case"binary":var s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);var o=new Uint8Array(s.buffer);return o.set(t.value,3),o;case"string":var i=this.fromUtf8(t.value),c=new DataView(new ArrayBuffer(3+i.byteLength));c.setUint8(0,7),c.setUint16(1,i.byteLength,!1);var u=new Uint8Array(c.buffer);return u.set(i,3),u;case"timestamp":var l=new Uint8Array(9);return l[0]=8,l.set(v.fromNumber(t.value.valueOf()).bytes,1),l;case"uuid":if(!x.test(t.value))throw new Error("Invalid UUID received: "+t.value);var f=new Uint8Array(17);return f[0]=9,f.set(e.fromHex(t.value.replace(/\-/g,"")),1),f}},a.prototype.parse=function(t){for(var a={},r=0;r<t.byteLength;){var n=t.getUint8(r++),s=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+r,n));switch(r+=n,t.getUint8(r++)){case 0:a[s]={type:_,value:!0};break;case 1:a[s]={type:_,value:!1};break;case 2:a[s]={type:k,value:t.getInt8(r++)};break;case 3:a[s]={type:z,value:t.getInt16(r,!1)},r+=2;break;case 4:a[s]={type:E,value:t.getInt32(r,!1)},r+=4;break;case 5:a[s]={type:S,value:new v(new Uint8Array(t.buffer,t.byteOffset+r,8))},r+=8;break;case 6:var o=t.getUint16(r,!1);r+=2,a[s]={type:U,value:new Uint8Array(t.buffer,t.byteOffset+r,o)},r+=o;break;case 7:var i=t.getUint16(r,!1);r+=2,a[s]={type:A,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+r,i))},r+=i;break;case 8:a[s]={type:O,value:new Date(new v(new Uint8Array(t.buffer,t.byteOffset+r,8)).valueOf())},r+=8;break;case 9:var c=new Uint8Array(t.buffer,t.byteOffset+r,16);r+=16,a[s]={type:P,value:e.toHex(c.subarray(0,4))+"-"+e.toHex(c.subarray(4,6))+"-"+e.toHex(c.subarray(6,8))+"-"+e.toHex(c.subarray(8,10))+"-"+e.toHex(c.subarray(10))};break;default:throw new Error("Unrecognized header type tag")}}return a},a}();!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(b||(b={}));var _="boolean",k="byte",z="short",E="integer",S="long",U="binary",A="string",O="timestamp",P="uuid",x=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var I=function(){function e(e,t){this.headerMarshaller=new g(e,t)}return e.prototype.marshall=function(e){var t=e.headers,a=e.body,r=this.headerMarshaller.format(t),n=r.byteLength+a.byteLength+16,s=new Uint8Array(n),o=new DataView(s.buffer,s.byteOffset,s.byteLength),i=new d.Crc32;return o.setUint32(0,n,!1),o.setUint32(4,r.byteLength,!1),o.setUint32(8,i.update(s.subarray(0,8)).digest(),!1),s.set(r,12),s.set(a,r.byteLength+12),o.setUint32(n-4,i.update(s.subarray(8,n-4)).digest(),!1),s},e.prototype.unmarshall=function(e){var t=function(e){var t=e.byteLength,a=e.byteOffset,r=e.buffer;if(t<16)throw new Error("Provided message too short to accommodate event stream message overhead");var n=new DataView(r,a,t),s=n.getUint32(0,!1);if(t!==s)throw new Error("Reported message length does not match received message length");var o=n.getUint32(4,!1),i=n.getUint32(8,!1),c=n.getUint32(t-4,!1),u=(new d.Crc32).update(new Uint8Array(r,a,8));if(i!==u.digest())throw new Error("The prelude checksum specified in the message ("+i+") does not match the calculated CRC32 checksum ("+u.digest()+")");if(u.update(new Uint8Array(r,a+8,t-12)),c!==u.digest())throw new Error("The message checksum ("+u.digest()+") did not match the expected value of "+c);return{headers:new DataView(r,a+8+4,o),body:new Uint8Array(r,a+8+4+o,s-o-16)}}(e),a=t.headers,r=t.body;return{headers:this.headerMarshaller.parse(a),body:r}},e.prototype.formatHeaders=function(e){return this.headerMarshaller.format(e)},e}();var R=function(){function e(e){var t=e.utf8Encoder,a=e.utf8Decoder;this.eventMarshaller=new I(t,a),this.utfEncoder=t}return e.prototype.deserialize=function(e,a){var r,n,s,o,i,c,u;return function(e,a){var r;return(r={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var r,n,s,o,i,c,u,l,f,h,p,w,m,d,v,y,b;return t.__generator(this,(function(g){switch(g.label){case 0:g.trys.push([0,12,13,18]),r=t.__asyncValues(e),g.label=1;case 1:return[4,t.__await(r.next())];case 2:if((n=g.sent()).done)return[3,11];if(s=n.value,o=a.eventMarshaller.unmarshall(s),"error"!==(i=o.headers[":message-type"].value))return[3,3];throw(c=new Error(o.headers[":error-message"].value||"UnknownError")).name=o.headers[":error-code"].value,c;case 3:return"exception"!==i?[3,5]:(u=o.headers[":exception-type"].value,(d={})[u]=o,l=d,[4,t.__await(a.deserializer(l))]);case 4:if((f=g.sent()).$unknown)throw(h=new Error(a.toUtf8(o.body))).name=u,h;throw f[u];case 5:return"event"!==i?[3,9]:((v={})[o.headers[":event-type"].value]=o,p=v,[4,t.__await(a.deserializer(p))]);case 6:return(w=g.sent()).$unknown?[3,10]:[4,t.__await(w)];case 7:return[4,g.sent()];case 8:return g.sent(),[3,10];case 9:throw Error("Unrecognizable event type: "+o.headers[":event-type"].value);case 10:return[3,1];case 11:return[3,18];case 12:return m=g.sent(),y={error:m},[3,18];case 13:return g.trys.push([13,,16,17]),n&&!n.done&&(b=r.return)?[4,t.__await(b.call(r))]:[3,15];case 14:g.sent(),g.label=15;case 15:return[3,17];case 16:if(y)throw y.error;return[7];case 17:return[7];case 18:return[2]}}))}))},r}((r=e,s=0,o=0,i=null,c=null,u=function(e){if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);s=e,o=4,i=new Uint8Array(e),new DataView(i.buffer).setUint32(0,e,!1)},(n={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var e,a,n,l,f,h,p,w;return t.__generator(this,(function(m){switch(m.label){case 0:e=r[Symbol.asyncIterator](),m.label=1;case 1:return[4,t.__await(e.next())];case 2:return a=m.sent(),n=a.value,a.done?s?[3,4]:[4,t.__await(void 0)]:[3,10];case 3:return[2,m.sent()];case 4:return s!==o?[3,7]:[4,t.__await(i)];case 5:return[4,m.sent()];case 6:return m.sent(),[3,8];case 7:throw new Error("Truncated event message received.");case 8:return[4,t.__await(void 0)];case 9:return[2,m.sent()];case 10:l=n.length,f=0,m.label=11;case 11:if(!(f<l))return[3,15];if(!i){if(h=l-f,c||(c=new Uint8Array(4)),p=Math.min(4-o,h),c.set(n.slice(f,f+p),o),f+=p,(o+=p)<4)return[3,15];u(new DataView(c.buffer).getUint32(0,!1)),c=null}return w=Math.min(s-o,l-f),i.set(n.slice(f,f+w),o),o+=w,f+=w,s&&s===o?[4,t.__await(i)]:[3,14];case 12:return[4,m.sent()];case 13:m.sent(),i=null,s=0,o=0,m.label=14;case 14:return[3,11];case 15:return[3,1];case 16:return[2]}}))}))},n),{eventMarshaller:this.eventMarshaller,deserializer:a,toUtf8:this.utfEncoder})},e.prototype.serialize=function(e,a){var r,n=this;return(r={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var r,s,o,i,c,u,l;return t.__generator(this,(function(f){switch(f.label){case 0:f.trys.push([0,7,8,13]),r=t.__asyncValues(e),f.label=1;case 1:return[4,t.__await(r.next())];case 2:return(s=f.sent()).done?[3,6]:(o=s.value,i=n.eventMarshaller.marshall(a(o)),[4,t.__await(i)]);case 3:return[4,f.sent()];case 4:f.sent(),f.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return c=f.sent(),u={error:c},[3,13];case 8:return f.trys.push([8,,11,12]),s&&!s.done&&(l=r.return)?[4,t.__await(l.call(r))]:[3,10];case 9:f.sent(),f.label=10;case 10:return[3,12];case 11:if(u)throw u.error;return[7];case 12:return[7];case 13:return[4,t.__await(new Uint8Array(0))];case 14:return[4,f.sent()];case 15:return f.sent(),[2]}}))}))},r},e}();var C=function(){function e(e){var t=e.utf8Encoder,a=e.utf8Decoder;this.eventMarshaller=new I(t,a),this.universalMarshaller=new R({utf8Decoder:a,utf8Encoder:t})}return e.prototype.deserialize=function(e,a){var r="function"==typeof e[Symbol.asyncIterator]?e:function(e){return t.__asyncGenerator(this,arguments,(function(){var a,r,n,s;return t.__generator(this,(function(o){switch(o.label){case 0:a=!1,r=!1,n=new Array,e.on("error",(function(e){if(a||(a=!0),e)throw e})),e.on("data",(function(e){n.push(e)})),e.on("end",(function(){a=!0})),o.label=1;case 1:return r?[3,6]:[4,t.__await(new Promise((function(e){return setTimeout((function(){return e(n.shift())}),0)})))];case 2:return(s=o.sent())?[4,t.__await(s)]:[3,5];case 3:return[4,o.sent()];case 4:o.sent(),o.label=5;case 5:return r=a&&0===n.length,[3,1];case 6:return[2]}}))}))}(e);return this.universalMarshaller.deserialize(r,a)},e.prototype.serialize=function(e,a){var n=this.universalMarshaller.serialize(e,a);if("function"==typeof r.Readable.from)return r.Readable.from(n);var s=n[Symbol.asyncIterator](),o=new r.Readable({autoDestroy:!0,objectMode:!0,read:function(){return t.__awaiter(this,void 0,void 0,(function(){var e=this;return t.__generator(this,(function(t){return s.next().then((function(t){var a=t.done,r=t.value;a?e.push(null):e.push(r)})).catch((function(t){e.destroy(t)})),[2]}))}))}});return o.on("error",(function(){o.destroy()})),o.on("end",(function(){o.destroy()})),o},e}(),N=function(e){function a(t,a){var r=e.call(this,a)||this;return r.hash=t,r}return t.__extends(a,e),a.prototype._write=function(e,t,a){try{this.hash.update(e)}catch(e){return a(e)}a()},a}(r.Writable);var D={environmentVariableSelector:function(e){if(Object.prototype.hasOwnProperty.call(e,"AWS_S3_USE_ARN_REGION")){if("true"===e.AWS_S3_USE_ARN_REGION)return!0;if("false"===e.AWS_S3_USE_ARN_REGION)return!1;throw new Error('Cannot load env AWS_S3_USE_ARN_REGION. Expected "true" or "false", got '+e.AWS_S3_USE_ARN_REGION+".")}},configFileSelector:function(e){if(Object.prototype.hasOwnProperty.call(e,"s3_use_arn_region")){if("true"===e.s3_use_arn_region)return!0;if("false"===e.s3_use_arn_region)return!1;throw new Error('Cannot load shared config entry s3_use_arn_region. Expected "true" or "false", got '+e.s3_use_arn_region+".")}},default:!1};const j=new Set(["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-west-1","us-west-2"]),M=new Set(["cn-north-1","cn-northwest-1"]),T=new Set(["us-iso-east-1"]),H=new Set(["us-isob-east-1"]),q=new Set(["us-gov-east-1","us-gov-west-1"]),L={apiVersion:"2006-03-01",disableHostPrefix:!1,logger:{},regionInfoProvider:(e,t)=>{let a;switch(e){case"accesspoint-af-south-1":a={hostname:"s3-accesspoint.af-south-1.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-east-1":a={hostname:"s3-accesspoint.ap-east-1.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-northeast-1":a={hostname:"s3-accesspoint.ap-northeast-1.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-northeast-2":a={hostname:"s3-accesspoint.ap-northeast-2.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-northeast-3":a={hostname:"s3-accesspoint.ap-northeast-3.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-south-1":a={hostname:"s3-accesspoint.ap-south-1.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-southeast-1":a={hostname:"s3-accesspoint.ap-southeast-1.amazonaws.com",partition:"aws"};break;case"accesspoint-ap-southeast-2":a={hostname:"s3-accesspoint.ap-southeast-2.amazonaws.com",partition:"aws"};break;case"accesspoint-ca-central-1":a={hostname:"s3-accesspoint.ca-central-1.amazonaws.com",partition:"aws"};break;case"accesspoint-cn-north-1":a={hostname:"s3-accesspoint.cn-north-1.amazonaws.com.cn",partition:"aws-cn"};break;case"accesspoint-cn-northwest-1":a={hostname:"s3-accesspoint.cn-northwest-1.amazonaws.com.cn",partition:"aws-cn"};break;case"accesspoint-eu-central-1":a={hostname:"s3-accesspoint.eu-central-1.amazonaws.com",partition:"aws"};break;case"accesspoint-eu-north-1":a={hostname:"s3-accesspoint.eu-north-1.amazonaws.com",partition:"aws"};break;case"accesspoint-eu-south-1":a={hostname:"s3-accesspoint.eu-south-1.amazonaws.com",partition:"aws"};break;case"accesspoint-eu-west-1":a={hostname:"s3-accesspoint.eu-west-1.amazonaws.com",partition:"aws"};break;case"accesspoint-eu-west-2":a={hostname:"s3-accesspoint.eu-west-2.amazonaws.com",partition:"aws"};break;case"accesspoint-eu-west-3":a={hostname:"s3-accesspoint.eu-west-3.amazonaws.com",partition:"aws"};break;case"accesspoint-me-south-1":a={hostname:"s3-accesspoint.me-south-1.amazonaws.com",partition:"aws"};break;case"accesspoint-sa-east-1":a={hostname:"s3-accesspoint.sa-east-1.amazonaws.com",partition:"aws"};break;case"accesspoint-us-east-1":a={hostname:"s3-accesspoint.us-east-1.amazonaws.com",partition:"aws"};break;case"accesspoint-us-east-2":a={hostname:"s3-accesspoint.us-east-2.amazonaws.com",partition:"aws"};break;case"accesspoint-us-gov-east-1":a={hostname:"s3-accesspoint.us-gov-east-1.amazonaws.com",partition:"aws-us-gov"};break;case"accesspoint-us-gov-west-1":a={hostname:"s3-accesspoint.us-gov-west-1.amazonaws.com",partition:"aws-us-gov"};break;case"accesspoint-us-west-1":a={hostname:"s3-accesspoint.us-west-1.amazonaws.com",partition:"aws"};break;case"accesspoint-us-west-2":a={hostname:"s3-accesspoint.us-west-2.amazonaws.com",partition:"aws"};break;case"af-south-1":a={hostname:"s3.af-south-1.amazonaws.com",partition:"aws"};break;case"ap-east-1":a={hostname:"s3.ap-east-1.amazonaws.com",partition:"aws"};break;case"ap-northeast-1":a={hostname:"s3.ap-northeast-1.amazonaws.com",partition:"aws"};break;case"ap-northeast-2":a={hostname:"s3.ap-northeast-2.amazonaws.com",partition:"aws"};break;case"ap-northeast-3":a={hostname:"s3.ap-northeast-3.amazonaws.com",partition:"aws"};break;case"ap-south-1":a={hostname:"s3.ap-south-1.amazonaws.com",partition:"aws"};break;case"ap-southeast-1":a={hostname:"s3.ap-southeast-1.amazonaws.com",partition:"aws"};break;case"ap-southeast-2":a={hostname:"s3.ap-southeast-2.amazonaws.com",partition:"aws"};break;case"aws-global":a={hostname:"s3.amazonaws.com",partition:"aws",signingRegion:"us-east-1"};break;case"ca-central-1":a={hostname:"s3.ca-central-1.amazonaws.com",partition:"aws"};break;case"cn-north-1":a={hostname:"s3.cn-north-1.amazonaws.com.cn",partition:"aws-cn"};break;case"cn-northwest-1":a={hostname:"s3.cn-northwest-1.amazonaws.com.cn",partition:"aws-cn"};break;case"eu-central-1":a={hostname:"s3.eu-central-1.amazonaws.com",partition:"aws"};break;case"eu-north-1":a={hostname:"s3.eu-north-1.amazonaws.com",partition:"aws"};break;case"eu-south-1":a={hostname:"s3.eu-south-1.amazonaws.com",partition:"aws"};break;case"eu-west-1":a={hostname:"s3.eu-west-1.amazonaws.com",partition:"aws"};break;case"eu-west-2":a={hostname:"s3.eu-west-2.amazonaws.com",partition:"aws"};break;case"eu-west-3":a={hostname:"s3.eu-west-3.amazonaws.com",partition:"aws"};break;case"fips-accesspoint-ca-central-1":a={hostname:"s3-accesspoint-fips.ca-central-1.amazonaws.com",partition:"aws"};break;case"fips-accesspoint-us-east-1":a={hostname:"s3-accesspoint-fips.us-east-1.amazonaws.com",partition:"aws"};break;case"fips-accesspoint-us-east-2":a={hostname:"s3-accesspoint-fips.us-east-2.amazonaws.com",partition:"aws"};break;case"fips-accesspoint-us-gov-east-1":a={hostname:"s3-accesspoint-fips.us-gov-east-1.amazonaws.com",partition:"aws-us-gov"};break;case"fips-accesspoint-us-gov-west-1":a={hostname:"s3-accesspoint-fips.us-gov-west-1.amazonaws.com",partition:"aws-us-gov"};break;case"fips-accesspoint-us-west-1":a={hostname:"s3-accesspoint-fips.us-west-1.amazonaws.com",partition:"aws"};break;case"fips-accesspoint-us-west-2":a={hostname:"s3-accesspoint-fips.us-west-2.amazonaws.com",partition:"aws"};break;case"fips-us-gov-west-1":a={hostname:"s3-fips.us-gov-west-1.amazonaws.com",partition:"aws-us-gov",signingRegion:"us-gov-west-1"};break;case"me-south-1":a={hostname:"s3.me-south-1.amazonaws.com",partition:"aws"};break;case"s3-external-1":a={hostname:"s3-external-1.amazonaws.com",partition:"aws",signingRegion:"us-east-1"};break;case"sa-east-1":a={hostname:"s3.sa-east-1.amazonaws.com",partition:"aws"};break;case"us-east-1":a={hostname:"s3.us-east-1.amazonaws.com",partition:"aws"};break;case"us-east-2":a={hostname:"s3.us-east-2.amazonaws.com",partition:"aws"};break;case"us-gov-east-1":a={hostname:"s3.us-gov-east-1.amazonaws.com",partition:"aws-us-gov"};break;case"us-gov-west-1":a={hostname:"s3.us-gov-west-1.amazonaws.com",partition:"aws-us-gov"};break;case"us-iso-east-1":a={hostname:"s3.us-iso-east-1.c2s.ic.gov",partition:"aws-iso"};break;case"us-isob-east-1":a={hostname:"s3.us-isob-east-1.sc2s.sgov.gov",partition:"aws-iso-b"};break;case"us-west-1":a={hostname:"s3.us-west-1.amazonaws.com",partition:"aws"};break;case"us-west-2":a={hostname:"s3.us-west-2.amazonaws.com",partition:"aws"};break;default:j.has(e)&&(a={hostname:"s3.{region}.amazonaws.com".replace("{region}",e),partition:"aws"}),M.has(e)&&(a={hostname:"s3.{region}.amazonaws.com.cn".replace("{region}",e),partition:"aws-cn"}),T.has(e)&&(a={hostname:"s3.{region}.c2s.ic.gov".replace("{region}",e),partition:"aws-iso"}),H.has(e)&&(a={hostname:"s3.{region}.sc2s.sgov.gov".replace("{region}",e),partition:"aws-iso-b"}),q.has(e)&&(a={hostname:"s3.{region}.amazonaws.com".replace("{region}",e),partition:"aws-us-gov"}),void 0===a&&(a={hostname:"s3.{region}.amazonaws.com".replace("{region}",e),partition:"aws"})}return Promise.resolve({signingService:"s3",...a})},serviceId:"S3",signingEscapePath:!1,urlParser:e.parseUrl,useArnRegion:!1},G={...L,runtime:"node",base64Decoder:e.fromBase64,base64Encoder:e.toBase64,bodyLengthChecker:e.calculateBodyLength,credentialDefaultProvider:e.decorateDefaultCredentialProvider(e.defaultProvider),defaultUserAgentProvider:e.defaultUserAgent({serviceId:L.serviceId,clientVersion:c}),eventStreamSerdeProvider:function(e){return new C(e)},maxAttempts:e.loadConfig(s.NODE_MAX_ATTEMPT_CONFIG_OPTIONS),md5:e.Hash.bind(null,"md5"),region:e.loadConfig(e.NODE_REGION_CONFIG_OPTIONS,e.NODE_REGION_CONFIG_FILE_OPTIONS),requestHandler:new e.NodeHttpHandler,retryModeProvider:e.loadConfig(s.NODE_RETRY_MODE_CONFIG_OPTIONS),sha256:e.Hash.bind(null,"sha256"),streamCollector:e.streamCollector,streamHasher:function(e,t){return new Promise((function(a,r){if("string"==typeof t.path){var s=n.createReadStream(t.path,{start:t.start,end:t.end}),o=new e,i=new N(o);s.pipe(i),s.on("error",(function(e){i.end(),r(e)})),i.on("error",r),i.on("finish",(function(){o.digest().then(a).catch(r)}))}else r(new Error("Unable to calculate hash for non-file streams."))}))},useArnRegion:e.loadConfig(D),utf8Decoder:e.fromUtf8,utf8Encoder:e.toUtf8};var V={step:"build",tags:["SET_EXPECT_HEADER","EXPECT_HEADER"],name:"addExpectContinueMiddleware",override:!0},B=function(e){return{applyToStack:function(a){a.add(function(e){var a=this;return function(r){return function(n){return t.__awaiter(a,void 0,void 0,(function(){var a;return t.__generator(this,(function(s){return a=n.request,t.HttpRequest.isInstance(a)&&a.body&&"node"===e.runtime&&(a.headers=t.__assign(t.__assign({},a.headers),{Expect:"100-continue"})),[2,r(t.__assign(t.__assign({},n),{request:a}))]}))}))}}}(e),V)}}};var F={step:"initialize",tags:["VALIDATE_BUCKET_NAME"],name:"validateBucketNameMiddleware",override:!0},W=function(e){return{applyToStack:function(e){e.add(function(){var e=this;return function(a){return function(r){return t.__awaiter(e,void 0,void 0,(function(){var e,n;return t.__generator(this,(function(s){if("string"==typeof(e=r.input.Bucket)&&!o.validate(e)&&e.indexOf("/")>=0)throw(n=new Error("Bucket name shouldn't contain '/', received '"+e+"'")).name="InvalidBucketName",n;return[2,a(t.__assign({},r))]}))}))}}}(),F)}}},X={step:"build",tags:["USE_REGIONAL_ENDPOINT","S3"],name:"useRegionalEndpointMiddleware",override:!0},$=function(e){return{applyToStack:function(a){a.add(function(e){return function(a){return function(r){return t.__awaiter(void 0,void 0,void 0,(function(){var n,s;return t.__generator(this,(function(o){switch(o.label){case 0:return n=r.request,!t.HttpRequest.isInstance(n)||e.isCustomEndpoint?[2,a(t.__assign({},r))]:"s3.amazonaws.com"!==n.hostname?[3,1]:(n.hostname="s3.us-east-1.amazonaws.com",[3,3]);case 1:return s="aws-global",[4,e.region()];case 2:s===o.sent()&&(n.hostname="s3.amazonaws.com"),o.label=3;case 3:return[2,a(t.__assign({},r))]}}))}))}}}(e),X)}}};class K extends i.Client{constructor(a){let r={...G,...a},n=e.resolveRegionConfig(r),o=e.resolveEndpointsConfig(n),i=s.resolveRetryConfig(o),c=e.resolveHostHeaderConfig(i),u=e.resolveAwsAuthConfig(c),l=(h=(f=u).bucketEndpoint,p=void 0!==h&&h,w=f.forcePathStyle,m=void 0!==w&&w,d=f.useAccelerateEndpoint,v=void 0!==d&&d,y=f.useDualstackEndpoint,b=void 0!==y&&y,g=f.useArnRegion,_=void 0!==g&&g,t.__assign(t.__assign({},f),{bucketEndpoint:p,forcePathStyle:m,useAccelerateEndpoint:v,useDualstackEndpoint:b,useArnRegion:"function"==typeof _?_:function(){return Promise.resolve(_)}}));var f,h,p,w,m,d,v,y,b,g,_;let k=function(e){return t.__assign(t.__assign({},e),{eventStreamMarshaller:e.eventStreamSerdeProvider(e)})}(e.resolveUserAgentConfig(l));super(k),this.config=k,this.middlewareStack.use(s.getRetryPlugin(this.config)),this.middlewareStack.use(e.getContentLengthPlugin(this.config)),this.middlewareStack.use(e.getHostHeaderPlugin(this.config)),this.middlewareStack.use(e.getLoggerPlugin(this.config)),this.middlewareStack.use(e.getAwsAuthPlugin(this.config)),this.middlewareStack.use(W(this.config)),this.middlewareStack.use($(this.config)),this.middlewareStack.use(B(this.config)),this.middlewareStack.use(e.getUserAgentPlugin(this.config))}destroy(){super.destroy()}}exports.S3Client=K;
