"use strict";var t=require("./httpRequest-eeeab15a.js");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=e(require("crypto")),n=function(e){return function(r,n){return function(i){return t.__awaiter(void 0,void 0,void 0,(function(){var a;return t.__generator(this,(function(o){switch(o.label){case 0:return[4,e.retryStrategy()];case 1:return(null==(a=o.sent())?void 0:a.mode)&&(n.userAgent=t.__spreadArray(t.__spreadArray([],t.__read(n.userAgent||[])),[["cfg/retry-mode",a.mode]])),[2,a.retry(r,i)]}}))}))}}},i={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},a=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],o=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],s=["AbortError","TimeoutError","RequestTimeout","RequestTimeoutException"],u=[500,502,503,504],c=function(t){var e,r;return 429===(null===(e=t.$metadata)||void 0===e?void 0:e.httpStatusCode)||o.includes(t.name)||1==(null===(r=t.$retryable)||void 0===r?void 0:r.throttling)};const l=new Uint8Array(256);let d=l.length;function h(){return d>l.length-16&&(r.default.randomFillSync(l),d=0),l.slice(d,d+=16)}var p=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const m=[];for(let t=0;t<256;++t)m.push((t+256).toString(16).substr(1));function f(t,e=0){const r=(m[t[e+0]]+m[t[e+1]]+m[t[e+2]]+m[t[e+3]]+"-"+m[t[e+4]]+m[t[e+5]]+"-"+m[t[e+6]]+m[t[e+7]]+"-"+m[t[e+8]]+m[t[e+9]]+"-"+m[t[e+10]]+m[t[e+11]]+m[t[e+12]]+m[t[e+13]]+m[t[e+14]]+m[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&p.test(t)}(r))throw TypeError("Stringified UUID is invalid");return r}function T(t,e,r){const n=(t=t||{}).random||(t.rng||h)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=n[t];return e}return f(n)}var y;exports.RETRY_MODES=void 0,(y=exports.RETRY_MODES||(exports.RETRY_MODES={})).STANDARD="standard",y.ADAPTIVE="adaptive";var v=exports.RETRY_MODES.STANDARD,R=function(t,e){return Math.floor(Math.min(2e4,Math.random()*Math.pow(2,e)*t))},_=function(t){return!!t&&(function(t){return void 0!==t.$retryable}(t)||function(t){return a.includes(t.name)}(t)||c(t)||function(t){var e;return s.includes(t.name)||u.includes((null===(e=t.$metadata)||void 0===e?void 0:e.httpStatusCode)||0)}(t))},E=function(){function e(t,e){var r,n,i;this.maxAttemptsProvider=t,this.mode=exports.RETRY_MODES.STANDARD,this.retryDecider=null!==(r=null==e?void 0:e.retryDecider)&&void 0!==r?r:_,this.delayDecider=null!==(n=null==e?void 0:e.delayDecider)&&void 0!==n?n:R,this.retryQuota=null!==(i=null==e?void 0:e.retryQuota)&&void 0!==i?i:function(t,e){var r,n,i,a=t,o=null!==(r=null==e?void 0:e.noRetryIncrement)&&void 0!==r?r:1,s=null!==(n=null==e?void 0:e.retryCost)&&void 0!==n?n:5,u=null!==(i=null==e?void 0:e.timeoutRetryCost)&&void 0!==i?i:10,c=t,l=function(t){return"TimeoutError"===t.name?u:s},d=function(t){return l(t)<=c};return Object.freeze({hasRetryTokens:d,retrieveRetryTokens:function(t){if(!d(t))throw new Error("No retry token available");var e=l(t);return c-=e,e},releaseRetryTokens:function(t){c+=null!=t?t:o,c=Math.min(c,a)}})}(500)}return e.prototype.shouldRetry=function(t,e,r){return e<r&&this.retryDecider(t)&&this.retryQuota.hasRetryTokens(t)},e.prototype.getMaxAttempts=function(){return t.__awaiter(this,void 0,void 0,(function(){var e;return t.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.maxAttemptsProvider()];case 1:return e=t.sent(),[3,3];case 2:return t.sent(),e=3,[3,3];case 3:return[2,e]}}))}))},e.prototype.retry=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,a,o,s,u,l,d,h;return t.__generator(this,(function(p){switch(p.label){case 0:return a=0,o=0,[4,this.getMaxAttempts()];case 1:s=p.sent(),u=r.request,t.HttpRequest.isInstance(u)&&(u.headers["amz-sdk-invocation-id"]=T()),l=function(){var l,h,p,m,f,T;return t.__generator(this,(function(y){switch(y.label){case 0:return y.trys.push([0,4,,7]),t.HttpRequest.isInstance(u)&&(u.headers["amz-sdk-request"]="attempt="+(a+1)+"; max="+s),(null==n?void 0:n.beforeRequest)?[4,n.beforeRequest()]:[3,2];case 1:y.sent(),y.label=2;case 2:return[4,e(r)];case 3:return l=y.sent(),h=l.response,p=l.output,(null==n?void 0:n.afterRequest)&&n.afterRequest(h),d.retryQuota.releaseRetryTokens(i),p.$metadata.attempts=a+1,p.$metadata.totalRetryDelay=o,[2,{value:{response:h,output:p}}];case 4:return m=y.sent(),f=x(m),a++,d.shouldRetry(f,a,s)?(i=d.retryQuota.retrieveRetryTokens(f),T=d.delayDecider(c(f)?500:100,a),o+=T,[4,new Promise((function(t){return setTimeout(t,T)}))]):[3,6];case 5:return y.sent(),[2,"continue"];case 6:throw f.$metadata||(f.$metadata={}),f.$metadata.attempts=a,f.$metadata.totalRetryDelay=o,f;case 7:return[2]}}))},d=this,p.label=2;case 2:return[5,l()];case 3:return"object"==typeof(h=p.sent())?[2,h.value]:[3,2];case 4:return[2]}}))}))},e}(),x=function(t){return t instanceof Error?t:t instanceof Object?Object.assign(new Error,t):"string"==typeof t?new Error(t):new Error("AWS SDK error wrapper for "+t)},g=function(){function e(t){var e,r,n,i,a;this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=null!==(e=null==t?void 0:t.beta)&&void 0!==e?e:.7,this.minCapacity=null!==(r=null==t?void 0:t.minCapacity)&&void 0!==r?r:1,this.minFillRate=null!==(n=null==t?void 0:t.minFillRate)&&void 0!==n?n:.5,this.scaleConstant=null!==(i=null==t?void 0:t.scaleConstant)&&void 0!==i?i:.4,this.smooth=null!==(a=null==t?void 0:t.smooth)&&void 0!==a?a:.8;var o=this.getCurrentTimeInSeconds();this.lastThrottleTime=o,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}return e.prototype.getCurrentTimeInSeconds=function(){return Date.now()/1e3},e.prototype.getSendToken=function(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this.acquireTokenBucket(1)]}))}))},e.prototype.acquireTokenBucket=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r;return t.__generator(this,(function(t){switch(t.label){case 0:return this.enabled?(this.refillTokenBucket(),e>this.currentCapacity?(r=(e-this.currentCapacity)/this.fillRate*1e3,[4,new Promise((function(t){return setTimeout(t,r)}))]):[3,2]):[2];case 1:t.sent(),t.label=2;case 2:return this.currentCapacity=this.currentCapacity-e,[2]}}))}))},e.prototype.refillTokenBucket=function(){var t=this.getCurrentTimeInSeconds();if(this.lastTimestamp){var e=(t-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+e),this.lastTimestamp=t}else this.lastTimestamp=t},e.prototype.updateClientSendingRate=function(t){var e;if(this.updateMeasuredRate(),c(t)){var r=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=r,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),e=this.cubicThrottle(r),this.enableTokenBucket()}else this.calculateTimeWindow(),e=this.cubicSuccess(this.getCurrentTimeInSeconds());var n=Math.min(e,2*this.measuredTxRate);this.updateTokenBucketRate(n)},e.prototype.calculateTimeWindow=function(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))},e.prototype.cubicThrottle=function(t){return this.getPrecise(t*this.beta)},e.prototype.cubicSuccess=function(t){return this.getPrecise(this.scaleConstant*Math.pow(t-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)},e.prototype.enableTokenBucket=function(){this.enabled=!0},e.prototype.updateTokenBucketRate=function(t){this.refillTokenBucket(),this.fillRate=Math.max(t,this.minFillRate),this.maxCapacity=Math.max(t,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)},e.prototype.updateMeasuredRate=function(){var t=this.getCurrentTimeInSeconds(),e=Math.floor(2*t)/2;if(this.requestCount++,e>this.lastTxRateBucket){var r=this.requestCount/(e-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(r*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=e}},e.prototype.getPrecise=function(t){return parseFloat(t.toFixed(8))},e}(),S=function(e){function r(r,n){var i=this,a=null!=n?n:{},o=a.rateLimiter,s=t.__rest(a,["rateLimiter"]);return(i=e.call(this,r,s)||this).rateLimiter=null!=o?o:new g,i.mode=exports.RETRY_MODES.ADAPTIVE,i}return t.__extends(r,e),r.prototype.retry=function(r,n){return t.__awaiter(this,void 0,void 0,(function(){var i=this;return t.__generator(this,(function(a){return[2,e.prototype.retry.call(this,r,n,{beforeRequest:function(){return t.__awaiter(i,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this.rateLimiter.getSendToken()]}))}))},afterRequest:function(t){i.rateLimiter.updateClientSendingRate(t)}})]}))}))},r}(E),M={environmentVariableSelector:function(t){var e=t.AWS_MAX_ATTEMPTS;if(e){var r=parseInt(e);if(Number.isNaN(r))throw new Error('Environment variable AWS_MAX_ATTEMPTS mast be a number, got "'+e+'"');return r}},configFileSelector:function(t){var e=t.max_attempts;if(e){var r=parseInt(e);if(Number.isNaN(r))throw new Error('Shared config file entry max_attempts mast be a number, got "'+e+'"');return r}},default:3},A=function(t){if(void 0===t&&(t=3),"number"==typeof t){var e=Promise.resolve(t);return function(){return e}}return t},w={environmentVariableSelector:function(t){return t.AWS_RETRY_MODE},configFileSelector:function(t){return t.retry_mode},default:v};exports.AdaptiveRetryStrategy=S,exports.CONFIG_MAX_ATTEMPTS="max_attempts",exports.CONFIG_RETRY_MODE="retry_mode",exports.DEFAULT_MAX_ATTEMPTS=3,exports.DEFAULT_RETRY_MODE=v,exports.DefaultRateLimiter=g,exports.ENV_MAX_ATTEMPTS="AWS_MAX_ATTEMPTS",exports.ENV_RETRY_MODE="AWS_RETRY_MODE",exports.INVOCATION_ID_HEADER="amz-sdk-invocation-id",exports.NODE_MAX_ATTEMPT_CONFIG_OPTIONS=M,exports.NODE_RETRY_MODE_CONFIG_OPTIONS=w,exports.REQUEST_HEADER="amz-sdk-request",exports.StandardRetryStrategy=E,exports.defaultDelayDecider=R,exports.defaultRetryDecider=_,exports.getRetryPlugin=function(t){return{applyToStack:function(e){e.add(n(t),i)}}},exports.resolveRetryConfig=function(e){var r=A(e.maxAttempts);return t.__assign(t.__assign({},e),{maxAttempts:r,retryStrategy:function(){return t.__awaiter(void 0,void 0,void 0,(function(){var n;return t.__generator(this,(function(t){switch(t.label){case 0:return e.retryStrategy?[2,e.retryStrategy]:(n=e.retryMode)?[3,2]:[4,e.retryModeProvider()];case 1:n=t.sent(),t.label=2;case 2:return n===exports.RETRY_MODES.ADAPTIVE?[2,new S(r)]:[2,new E(r)]}}))}))}})},exports.retryMiddleware=n,exports.retryMiddlewareOptions=i;
