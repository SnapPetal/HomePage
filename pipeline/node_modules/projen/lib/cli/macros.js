"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.tryProcessMacro = void 0;
const path = require("path");
const util_1 = require("../util");
function tryProcessMacro(macro) {
    var _a, _b;
    if (!macro.startsWith('$')) {
        return undefined;
    }
    const basedir = path.basename(process.cwd());
    switch (macro) {
        case '$BASEDIR': return basedir;
        case '$GIT_REMOTE':
            const origin = util_1.execOrUndefined('git remote get-url origin');
            if (origin) {
                return origin;
            }
            const slug = (_a = getFromGitConfig('github.user')) !== null && _a !== void 0 ? _a : resolveEmail().split('@')[0];
            return `https://github.com/${slug}/${basedir}.git`;
        case '$GIT_USER_NAME': return (_b = getFromGitConfig('user.name')) !== null && _b !== void 0 ? _b : 'user';
        case '$GIT_USER_EMAIL': return resolveEmail();
    }
    return undefined;
}
exports.tryProcessMacro = tryProcessMacro;
/**
 * Returns a value from git config. Searches local and then global git config.
 * @param key the config key
 */
function getFromGitConfig(key) {
    var _a;
    return (_a = util_1.execOrUndefined(`git config --get --includes ${key}`)) !== null && _a !== void 0 ? _a : util_1.execOrUndefined(`git config --get --global --includes ${key}`);
}
function resolveEmail() {
    var _a;
    return (_a = getFromGitConfig('user.email')) !== null && _a !== void 0 ? _a : 'user@domain.com';
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjcm9zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NsaS9tYWNyb3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkJBQTZCO0FBQzdCLGtDQUEwQztBQUUxQyxTQUFnQixlQUFlLENBQUMsS0FBYTs7SUFDM0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFBRSxPQUFPLFNBQVMsQ0FBQztLQUFFO0lBRWpELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFFN0MsUUFBUSxLQUFLLEVBQUU7UUFDYixLQUFLLFVBQVUsQ0FBQyxDQUFDLE9BQU8sT0FBTyxDQUFDO1FBQ2hDLEtBQUssYUFBYTtZQUNoQixNQUFNLE1BQU0sR0FBRyxzQkFBZSxDQUFDLDJCQUEyQixDQUFDLENBQUM7WUFDNUQsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsT0FBTyxNQUFNLENBQUM7YUFDZjtZQUNELE1BQU0sSUFBSSxTQUFHLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxtQ0FBSSxZQUFZLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0UsT0FBTyxzQkFBc0IsSUFBSSxJQUFJLE9BQU8sTUFBTSxDQUFDO1FBRXJELEtBQUssZ0JBQWdCLENBQUMsQ0FBQyxhQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxtQ0FBSSxNQUFNLENBQUM7UUFDdEUsS0FBSyxpQkFBaUIsQ0FBQyxDQUFDLE9BQU8sWUFBWSxFQUFFLENBQUM7S0FDL0M7SUFFRCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBcEJELDBDQW9CQztBQUVEOzs7R0FHRztBQUNILFNBQVMsZ0JBQWdCLENBQUMsR0FBVzs7SUFDbkMsYUFBTyxzQkFBZSxDQUFDLCtCQUErQixHQUFHLEVBQUUsQ0FBQyxtQ0FDdkQsc0JBQWUsQ0FBQyx3Q0FBd0MsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUN0RSxDQUFDO0FBRUQsU0FBUyxZQUFZOztJQUNuQixhQUFPLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxtQ0FBSSxpQkFBaUIsQ0FBQztBQUM3RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4ZWNPclVuZGVmaW5lZCB9IGZyb20gJy4uL3V0aWwnO1xuXG5leHBvcnQgZnVuY3Rpb24gdHJ5UHJvY2Vzc01hY3JvKG1hY3JvOiBzdHJpbmcpIHtcbiAgaWYgKCFtYWNyby5zdGFydHNXaXRoKCckJykpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuXG4gIGNvbnN0IGJhc2VkaXIgPSBwYXRoLmJhc2VuYW1lKHByb2Nlc3MuY3dkKCkpO1xuXG4gIHN3aXRjaCAobWFjcm8pIHtcbiAgICBjYXNlICckQkFTRURJUic6IHJldHVybiBiYXNlZGlyO1xuICAgIGNhc2UgJyRHSVRfUkVNT1RFJzpcbiAgICAgIGNvbnN0IG9yaWdpbiA9IGV4ZWNPclVuZGVmaW5lZCgnZ2l0IHJlbW90ZSBnZXQtdXJsIG9yaWdpbicpO1xuICAgICAgaWYgKG9yaWdpbikge1xuICAgICAgICByZXR1cm4gb3JpZ2luO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2x1ZyA9IGdldEZyb21HaXRDb25maWcoJ2dpdGh1Yi51c2VyJykgPz8gcmVzb2x2ZUVtYWlsKCkuc3BsaXQoJ0AnKVswXTtcbiAgICAgIHJldHVybiBgaHR0cHM6Ly9naXRodWIuY29tLyR7c2x1Z30vJHtiYXNlZGlyfS5naXRgO1xuXG4gICAgY2FzZSAnJEdJVF9VU0VSX05BTUUnOiByZXR1cm4gZ2V0RnJvbUdpdENvbmZpZygndXNlci5uYW1lJykgPz8gJ3VzZXInO1xuICAgIGNhc2UgJyRHSVRfVVNFUl9FTUFJTCc6IHJldHVybiByZXNvbHZlRW1haWwoKTtcbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZyb20gZ2l0IGNvbmZpZy4gU2VhcmNoZXMgbG9jYWwgYW5kIHRoZW4gZ2xvYmFsIGdpdCBjb25maWcuXG4gKiBAcGFyYW0ga2V5IHRoZSBjb25maWcga2V5XG4gKi9cbmZ1bmN0aW9uIGdldEZyb21HaXRDb25maWcoa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICByZXR1cm4gZXhlY09yVW5kZWZpbmVkKGBnaXQgY29uZmlnIC0tZ2V0IC0taW5jbHVkZXMgJHtrZXl9YClcbiAgICA/PyBleGVjT3JVbmRlZmluZWQoYGdpdCBjb25maWcgLS1nZXQgLS1nbG9iYWwgLS1pbmNsdWRlcyAke2tleX1gKTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUVtYWlsKCk6IHN0cmluZyB7XG4gIHJldHVybiBnZXRGcm9tR2l0Q29uZmlnKCd1c2VyLmVtYWlsJykgPz8gJ3VzZXJAZG9tYWluLmNvbSc7XG59XG4iXX0=